'''
The ai of this is script is enumerate the different users,
rols and policies attached to a IAM user.
'''
import boto3
import os
import re

os.environ["AWS_PROFILE"] = "bilbo"
client_iam = boto3.client('iam') 
clien_sts = boto3.client('sts')

user_arn = clien_sts.get_caller_identity()['Arn']
print("[*] Identifying user")
try:
    user = re.search('user\/([^\s]+)', user_arn).group(1)
    print(f"[+] The usename is {user}")
except:
    print("The user has not been extracted successfully")

policies = {}
print("[+] Enumerating policies")
for policy in client_iam.list_user_policies(UserName=user)['PolicyNames']:
    policies[policy] = policy
    print(f"The policy {policy} is attached to the user")
    print(policies)
    for data in client_iam.get_user_policy(UserName=user, PolicyName=policy):
        print(data)